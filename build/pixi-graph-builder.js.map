{"version":3,"file":"pixi-graph-builder.js","sources":["webpack:///webpack/bootstrap dbc1295ca9c258bb5c9f","webpack:///./src/index.js","webpack:///./src/view.js","webpack:///./src/model.js","webpack:///./src/controls.js","webpack:///./src/render.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap dbc1295ca9c258bb5c9f\n **/","exports.version = '0.0.3';\nexports.create = function (config) {\n    var view = require('./view'),\n        model = require('./model');\n\n    var graph = {\n            initialConfig: config,\n            view: new view(config.view),\n            nodeTypes: config.nodeTypes\n        },\n        keyNodes = {};\n\n    graph.model = new model(graph.view, graph.nodeTypes, keyNodes, config);\n\n    graph.view.graph.interactive = true;\n\n    if (config.view.controls) {\n        require('./controls')(graph, config.view.controls, keyNodes);\n    }\n    require('./render')(graph);\n\n    return graph;\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/index.js\n ** module id = 0\n ** module chunks = 0\n **/","module.exports = function (cfg) {\n    this.width = cfg.width || window.innerWidth;\n    this.height = cfg.height || window.innerWidth;\n\n    this.renderer = new PIXI.WebGLRenderer(\n        this.width,\n        this.height,\n        {\n            transparent: cfg.transparent || false\n        });\n    this.stage = new PIXI.Container();\n    this.graph = new PIXI.Container();\n    this.links = new PIXI.Graphics();\n\n    this.graph.position.x = this.width / 2;\n    this.graph.position.y = this.height / 2;\n\n    this.graph.addChild(this.links);\n    this.stage.addChild(this.graph);\n\n    document.getElementById(cfg.element).appendChild(this.renderer.view);\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/view.js\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = function (view, nodeTypes, keyNodes, config) {\n    this.data = {\n        \"nodes\": [],\n        \"links\": []\n    };\n    var d = this.data;\n\n    this.force = d3.layout.force()\n        .nodes(this.data.nodes)\n        .links(this.data.links)\n        .gravity(0.002)\n        .charge(-100)\n        .linkDistance(35);\n\n    this.addNode = function (data) {\n        if (this.findNode(data.id)) {\n            return;\n        }\n        var nodeType = nodeTypes[data.type],\n            node = PIXI.Sprite.fromImage(nodeType.texture);\n\n        node.scale.x = nodeType.scale || 1;\n        node.scale.y = nodeType.scale || 1;\n        node.anchor.x = 0.5;\n        node.anchor.y = 0.5;\n\n        view.graph.addChild(node);\n\n        var index = this.data.nodes.push({\n            id: data.id,\n            data: data.data,\n            fixed: data.fixed || false,\n            x: data.pos ? data.pos.x : undefined,\n            y: data.pos ? data.pos.y : undefined,\n            multiId: data.multiId,\n            type: data.type,\n            $node: node\n        });\n\n        node.interactive = true;\n\n        node.on('mousedown', function (move) {\n            keyNodes.draggable = nodeType.draggable ? d.nodes[index - 1] : undefined;\n        });\n        node.on('rightclick', function (move) {\n            d.nodes[index - 1].fixed = false;\n        });\n        for (var key in nodeType.events) {\n            node.on(key, function (move) {\n                nodeType.events[key](move, d.nodes[index - 1]);\n            });\n        }\n        for (var key in config.events) {\n            node.on(key, function (move) {\n                config.events[key](move, d.nodes[index - 1]);\n            });\n        }\n        this.force.start();\n\n        return this.data.nodes[index - 1];\n    };\n\n    this.addLink = function (source, target, value) {\n        var source = this.findNode(source),\n            target = this.findNode(target),\n            link = new PIXI.Graphics();\n\n        if (config.links.directed) {\n            var arrowHead = PIXI.Sprite.fromImage(config.links.directed.arrow);\n            arrowHead.scale.x = config.links.directed.scale || 1;\n            arrowHead.scale.y = config.links.directed.scale || 1;\n            arrowHead.anchor.x = 0.5;\n            arrowHead.anchor.y = 0.5;\n            link.addChild(arrowHead);\n        }\n\n        view.links.addChild(link);\n\n        this.data.links.push({\n            \"source\": source,\n            \"target\": target,\n            \"value\": value,\n            \"$link\": link\n        });\n\n        this.force.start();\n    };\n\n    this.findNode = function (id) {\n        for (var i in this.data.nodes) {\n            if (this.data.nodes[i][\"id\"] === id) {\n                return this.data.nodes[i];\n            }\n        }\n    };\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/model.js\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = function (graph, config, keyNodes) {\n    var isDragging = false,\n        prevX, prevY, scale = 1;\n\n    graph.view.stage.hitArea = new PIXI.Rectangle(0, 0, window.innerWidth, window.innerHeight);\n    graph.view.stage.interactive = true;\n    graph.view.stage.on('mousedown', function (move) {\n        var pos = move.data.global;\n        prevX = pos.x;\n        prevY = pos.y;\n        isDragging = true;\n    });\n    graph.view.stage.on('mousemove', function (move) {\n        var pos = move.data.global,\n            local = move.data.getLocalPosition(graph.view.graph);\n        if (keyNodes.draggable) {\n            keyNodes.draggable.fixed = true;\n            keyNodes.draggable.px = local.x;\n            keyNodes.draggable.py = local.y;\n            graph.model.force.start();\n            return;\n        }\n        if (!isDragging) {\n            return;\n        }\n        graph.model.force.start();\n\n        graph.view.graph.position.x += pos.x - prevX;\n        graph.view.graph.position.y += pos.y - prevY;\n        prevX = pos.x;\n        prevY = pos.y;\n    });\n    graph.view.stage.on('mouseup', function () {\n        keyNodes.draggable = undefined;\n        isDragging = false;\n    });\n    onWheel({deltaY: 0});\n\n    graph.view.renderer.view.addEventListener(\"wheel\", onWheel);\n    function onWheel(e) {\n        var min = config.zoom && config.zoom.min || .01,\n            max = config.zoom && config.zoom.max || 3;\n        if (e.deltaY > 0) scale -= graph.view.graph.scale.x * .05;\n        else scale += graph.view.graph.scale.x * .05;\n\n        if (scale <= min) {\n            scale = min;\n        }\n        if (scale >= max) {\n            scale = max;\n        }\n        graph.model.data.nodes.forEach(function (item) {\n            item.$node.scale.x = item.$node.scale.y = (max + graph.initialConfig.nodeTypes[item.type].scale || 0.3) - scale;\n        });\n        graph.view.graph.scale.x = graph.view.graph.scale.y = scale;\n    }\n\n    graph.view.renderer.view.addEventListener(\"contextmenu\", function (e) {\n        e.preventDefault();\n    });\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/controls.js\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = function (graph) {\n    animate();\n    function animate() {\n\n        graph.model.data.nodes.forEach(function (i) {\n            i.$node.position.x = i.x;\n            i.$node.position.y = i.y;\n        });\n        graph.model.data.links.forEach(function (i) {\n            i.$link.clear();\n            i.$link.lineStyle(\n                graph.initialConfig.links.width || 1,\n                graph.initialConfig.links.color || 0x000000,\n                graph.initialConfig.links.opacity || 1);\n            i.$link.moveTo(i.target.x, i.target.y);\n            i.$link.lineTo(i.source.x, i.source.y);\n\n            if (i.$link.children[0]) {\n                i.$link.children[0].position.x = (i.target.x + i.source.x) / 2;\n                i.$link.children[0].position.y = (i.target.y + i.source.y) / 2;\n                i.$link.children[0].rotation = Math.atan2(i.target.y - i.source.y, i.target.x - i.source.x);\n            }\n        });\n        requestAnimationFrame(animate);\n        graph.view.renderer.render(graph.view.stage);\n    }\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/render.js\n ** module id = 4\n ** module chunks = 0\n **/"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;","sourceRoot":""}